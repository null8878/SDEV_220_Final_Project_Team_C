<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width = device-width, initial-scale = 1.0">
    <title>SplitSmart</title>
    <link rel="stylesheet" href="../static/style.css">

    <script>
        function validateForm() {
            //Pulling data from the user input forms
            let rm1 = document.getElementById("rm1").value
            let rm2 = document.getElementById("rm2").value
            let rm3 = document.getElementById("rm3").value
            let rm4 = document.getElementById("rm4").value

            let rent = document.getElementById("rent").value
            let groceries = document.getElementById("groceries").value

            inputArray = [rm1, rm2, rm3, rm4, rent, groceries]
            numberArray = [rent, groceries]

            //Checking that the costs are all valid numbers or blank

            for(let i = 0; i< numberArray.length;i++) {
                //Checking if the field is blank
                if (numberArray[i] === ""){
                    numberArray[i] = 0;
                }
                //Checkin if the field contains a number
                else if (isNaN(parseFloat(numberArray[i]))){
                    alert("Please input all costs as a valid number");
                    return false;
                }
                //Checking if the field contains a positive number
                else if(parseFloat(numberArray[i]) < 0){
                    alert("Please input all costs as a valid number");
                    return false;
                } 
                //The field input is a valid, positive number
                else {
                    numberArray[i] = parseFloat(numberArray[i]);
                }  
            }

            //returns true if all inputs are valid
            return true;
        }

        //onclick function for the Add Bill button
        function addBill() {
            if (!validateForm()) return;

            const data = {
                rm1: document.getElementById("rm1").value,
                rm2: document.getElementById("rm2").value,
                rm3: document.getElementById("rm3").value,
                rm4: document.getElementById("rm4").value,
                rent: document.getElementById("rent").value,
                groceries: document.getElementById("groceries").value
            };

            fetch('/add_expense', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                alert(result.status || result.error);
            })
            .catch(error => {
                console.error('Error:', error);
                alert("Failed to add expense.");
            });

            //Clearing the form
            document.getElementById("roomateForm").reset();
            document.getElementById("inputForm").reset();
        }

        //onclick function for the View Debts button
        function viewDebts() {
            if (!validateForm()) return;

            fetch('/get_expenses')
                .then(response => response.json())
                .then(data => {
                    let resultsDiv = document.getElementById("results");
                    resultsDiv.innerHTML = "<p>Results:</p><br>";

                    data.forEach(exp => {
                        resultsDiv.innerHTML += `• ${exp.description}: $${exp.amount}<br>`;
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert("Failed to load expenses.");
                });

            /* fetch('/get_balances')
                .then(response => response.json())
                .then(data => {
                    let resultsDiv = document.getElementById("results");
                    resultsDiv.innerHTML += "<br>";

                    data.forEach(exp => {
                        resultsDiv.innerHTML += `• ${exp.name}: $${exp.amount}<br>`;
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert("Failed to load expenses.");
                }); */
        }
    </script>
</head>
<body>
    <header>
        <h1>Welcome to SplitSmart</h1>
        <p>This is where we'll track shared expenses!</p>
    </header>

    <main>
        <div id="roommates">
            <form id = "roomateForm">
                <label for="rm1">Roommate 1:</label>
                <input type="text" id="rm1" name="rm1"><br>

                <label for="rm2">Roommate 2:</label>
                <input type="text" id="rm2" name="rm2"><br>

                <label for="rm3">Roommate 3:</label>
                <input type="text" id="rm3" name="rm3"><br>

                <label for="rm4">Roommate 4:</label>
                <input type="text" id="rm4" name="rm4"><br>
            </form>
        </div>

        <div id="userInputs">
            <form id = "inputForm">
                <label for="rent">Rent:</label>
                <input type="text" id="rent" name="rent"><br>

                <label for="groceries">Groceries:</label>
                <input type="text" id="groceries" name="groceries">
            </form>
        </div>

        <div id="buttons">
            <button onclick="addBill()">Add Bill</button>
            <button onclick="viewDebts()">View Debts</button>
        </div>

        <!--Placeholder div where final results could be displayed-->
        <div id="results">
            <p>Results:</p>
            <br>
        </div>
    </main>
</body>
</html>
